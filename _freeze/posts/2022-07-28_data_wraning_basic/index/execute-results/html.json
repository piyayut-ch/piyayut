{
  "hash": "8993757a253c99042d6e7b8e20a94a17",
  "result": {
    "markdown": "---\ntitle: \"Grammar of Data Manipulation in R and python\"\nauthor: \"Piyayut Chitchumnong\"\ndescription: | \n  A code snippet to how to implement basic data manipulation using R and python.\ndate: \"2022-07-28\"\ncategories: [tutorial, R, python, data-manipulation, data-wraning, data-transformation]\nexecute: \n  cache: false\nformat:\n  html:\n    toc: true\n    toc-depth: 2\n    df-print: tibble\n    number-sections: true\n    number-depth: 2\n\nknitr:\n  opts_chunk:\n    comment: \"#>\" \n---\n\n\n![Source: Photo by Engin Akyurt https://unsplash.com/photos/tYXBfhpZA1k](feature.jpg)\n\n# Introduction\n\nIn this tutorial, we cover basic data manipulation operations including\n\n- Reading data from variety of file formats.\n- Selecting variables.\n- Filtering rows.\n- Adding new variables.\n- Arranging rows by variables.\n- Summarizing and Grouping.\n- Reshaping data between wide and long format.\n- Joining tables using key(s) variable.\n- Saving data to desired file formats.\n\n# Load packages\nBoth `R` and `python` are open-source and very powerful for data-related work. There are many packages and libraries that can be used, the challenge is to learn and pick the right tool to the task in hand. In this tutorial, we choose standard tools in both language.\n\n::: {.panel-tabset}\n### R\nWe use\n\n- `dplyr` for data manipulation\n- `tidyr` for reshaping, join data\n- `readr` for read csv files\n- `readxl` for read/import excel files\n- `wriexl` for write/import excel files\n- `arrow` for read/write parquet files\n- `gapminder` example data for demonstration\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr, warn.conflicts = FALSE)\nlibrary(tidyr)\nlibrary(readr)\nlibrary(readxl)\nlibrary(writexl)\nlibrary(arrow, warn.conflicts = FALSE)\n# make sure that you have packaged installed in your machine/environments\n# you can install with install.packages(\"<library_name>\")\n```\n:::\n\n\n### python\nWe mainly use `pandas`, however additional packages required to be installed which are `openpyxl` and `pyarrow` package as we want to work with excel and parquet files.\n\n::: {.cell}\n\n```{.python .cell-code}\n# make sure that you have pandas pyarrow openpyxl \n# installed in your machine/environments\n# !pip install pandas openpyxl pyarrow\n\nimport pandas as pd\n```\n:::\n\n:::\n\n\n# Data: gapminder\nOne of the important step to conduct a data analytics or machine learning project is to understand the data.\n\nData used in this tutorial are from `gapminder` R package inspired by famous [Hans Rosling ted's talk](https://www.youtube.com/watch?v=hVimVzgtD6w). We use two tables which are\n\n- `gapminder` contain a data of countries from 1952 - 2007 with 3 variables including population (pop), life expectancy (LifeExp), and gdp per capita(gdpPercap).\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1,704 × 6\n#>    country     continent  year lifeExp      pop gdpPercap\n#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>\n#>  1 Afghanistan Asia       1952    28.8  8425333      779.\n#>  2 Afghanistan Asia       1957    30.3  9240934      821.\n#>  3 Afghanistan Asia       1962    32.0 10267083      853.\n#>  4 Afghanistan Asia       1967    34.0 11537966      836.\n#>  5 Afghanistan Asia       1972    36.1 13079460      740.\n#>  6 Afghanistan Asia       1977    38.4 14880372      786.\n#>  7 Afghanistan Asia       1982    39.9 12881816      978.\n#>  8 Afghanistan Asia       1987    40.8 13867957      852.\n#>  9 Afghanistan Asia       1992    41.7 16317921      649.\n#> 10 Afghanistan Asia       1997    41.8 22227415      635.\n#> # … with 1,694 more rows\n```\n:::\n:::\n\n\n- `country_codes` contains country names and associated ISO 3166-1 country codes (alpha and numeric) will be used for join.\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 187 × 3\n#>    country     iso_alpha iso_num\n#>    <chr>       <chr>       <int>\n#>  1 Afghanistan AFG             4\n#>  2 Albania     ALB             8\n#>  3 Algeria     DZA            12\n#>  4 Angola      AGO            24\n#>  5 Argentina   ARG            32\n#>  6 Armenia     ARM            51\n#>  7 Aruba       ABW           533\n#>  8 Australia   AUS            36\n#>  9 Austria     AUT            40\n#> 10 Azerbaijan  AZE            31\n#> # … with 177 more rows\n```\n:::\n:::\n\n\n# Reading data\nThere are many ways to get data into your machine for data analytics\n\n- files i.e. excel, csv, parquet, etc.\n- database\n- web api\n- web scraping\n\nFor the sake of simplicity, we use file approach. I will show how to read or write data in other approaches in future posts.\n\nThere are many file types, in this tutorial chooses the most common ones\n\n- `csv`\n- `excel`\n- `parquet`\n\n\n## csv\nCSV is a text file that each columns are seperated by commas stored in `.csv` file extension. Aside from `csv`, there are similar text file that store spreadsheet data but used different seperator or fixed width to determine column by position.\n\n::: {.panel-tabset}\n### R\nWe use function `read_csv` from `readr` package.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder <- read_csv(\"gapminder.csv\", show_col_types = FALSE) # readr package\ngapminder\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1,704 × 6\n#>    country     continent  year lifeExp      pop gdpPercap\n#>    <chr>       <chr>     <dbl>   <dbl>    <dbl>     <dbl>\n#>  1 Afghanistan Asia       1952    28.8  8425333      779.\n#>  2 Afghanistan Asia       1957    30.3  9240934      821.\n#>  3 Afghanistan Asia       1962    32.0 10267083      853.\n#>  4 Afghanistan Asia       1967    34.0 11537966      836.\n#>  5 Afghanistan Asia       1972    36.1 13079460      740.\n#>  6 Afghanistan Asia       1977    38.4 14880372      786.\n#>  7 Afghanistan Asia       1982    39.9 12881816      978.\n#>  8 Afghanistan Asia       1987    40.8 13867957      852.\n#>  9 Afghanistan Asia       1992    41.7 16317921      649.\n#> 10 Afghanistan Asia       1997    41.8 22227415      635.\n#> # … with 1,694 more rows\n```\n:::\n:::\n\n::: {.callout-note}\nNote `<-` is convention assignment in `R`, but `=` can also be used.\n:::\n\n\n### python\n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder = pd.read_csv(\"gapminder.csv\")\ngapminder\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>           country continent  year  lifeExp       pop   gdpPercap\n#> 0     Afghanistan      Asia  1952   28.801   8425333  779.445314\n#> 1     Afghanistan      Asia  1957   30.332   9240934  820.853030\n#> 2     Afghanistan      Asia  1962   31.997  10267083  853.100710\n#> 3     Afghanistan      Asia  1967   34.020  11537966  836.197138\n#> 4     Afghanistan      Asia  1972   36.088  13079460  739.981106\n#> ...           ...       ...   ...      ...       ...         ...\n#> 1699     Zimbabwe    Africa  1987   62.351   9216418  706.157306\n#> 1700     Zimbabwe    Africa  1992   60.377  10704340  693.420786\n#> 1701     Zimbabwe    Africa  1997   46.809  11404948  792.449960\n#> 1702     Zimbabwe    Africa  2002   39.989  11926563  672.038623\n#> 1703     Zimbabwe    Africa  2007   43.487  12311143  469.709298\n#> \n#> [1704 rows x 6 columns]\n```\n:::\n:::\n\n:::\n\n\n## excel\nMS excel is a spreadsheet program and store data in `.xls` (2003 version and before) or `.xlsx`. They are not text files like `csv`, but they are a kind of binary files (XML-like) format. An excel file can contain multiple sheets and within each sheet can have multiple tables.\n\n:::{.callout-tip}\nUnstructured excel files are difficult to work with using programming. Excel are still widely used by many organizations, so at leaset, we should convince users to make a proper spreadsheet for example follow [Broman and Woo' guideline](https://www.biostat.wisc.edu/~kbroman/publications/dataorg.pdf).\n:::\n\n\n::: {.panel-tabset}\n### R\nWe use function `read_excel` from `readxl` package. As an excel file can have multiple worksheets, we can read one sheet at a time and we can specify sheet to import using `sheet` argument where it could be index or sheet name.\n\n- read fist sheet.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder <- read_excel(\"gapminder.xlsx\")\ngapminder\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1,704 × 6\n#>    country     continent  year lifeExp      pop gdpPercap\n#>    <chr>       <chr>     <dbl>   <dbl>    <dbl>     <dbl>\n#>  1 Afghanistan Asia       1952    28.8  8425333      779.\n#>  2 Afghanistan Asia       1957    30.3  9240934      821.\n#>  3 Afghanistan Asia       1962    32.0 10267083      853.\n#>  4 Afghanistan Asia       1967    34.0 11537966      836.\n#>  5 Afghanistan Asia       1972    36.1 13079460      740.\n#>  6 Afghanistan Asia       1977    38.4 14880372      786.\n#>  7 Afghanistan Asia       1982    39.9 12881816      978.\n#>  8 Afghanistan Asia       1987    40.8 13867957      852.\n#>  9 Afghanistan Asia       1992    41.7 16317921      649.\n#> 10 Afghanistan Asia       1997    41.8 22227415      635.\n#> # … with 1,694 more rows\n```\n:::\n:::\n\n\n- read second sheet.\n\n::: {.cell}\n\n```{.r .cell-code}\ncountry_codes <- read_excel(\"gapminder.xlsx\", sheet = 2)\ncountry_codes\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 187 × 3\n#>    country     iso_alpha iso_num\n#>    <chr>       <chr>       <dbl>\n#>  1 Afghanistan AFG             4\n#>  2 Albania     ALB             8\n#>  3 Algeria     DZA            12\n#>  4 Angola      AGO            24\n#>  5 Argentina   ARG            32\n#>  6 Armenia     ARM            51\n#>  7 Aruba       ABW           533\n#>  8 Australia   AUS            36\n#>  9 Austria     AUT            40\n#> 10 Azerbaijan  AZE            31\n#> # … with 177 more rows\n```\n:::\n:::\n\n\n:::{.callout-note}\nIndex in `R` starts with 1.\n:::\n\n\n### python\n`pandas` has a function `read_excel` to import excel files.\n\n- read fist sheet.\n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder = pd.read_excel(\"gapminder.xlsx\")\ngapminder\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>           country continent  year  lifeExp       pop   gdpPercap\n#> 0     Afghanistan      Asia  1952   28.801   8425333  779.445314\n#> 1     Afghanistan      Asia  1957   30.332   9240934  820.853030\n#> 2     Afghanistan      Asia  1962   31.997  10267083  853.100710\n#> 3     Afghanistan      Asia  1967   34.020  11537966  836.197138\n#> 4     Afghanistan      Asia  1972   36.088  13079460  739.981106\n#> ...           ...       ...   ...      ...       ...         ...\n#> 1699     Zimbabwe    Africa  1987   62.351   9216418  706.157306\n#> 1700     Zimbabwe    Africa  1992   60.377  10704340  693.420786\n#> 1701     Zimbabwe    Africa  1997   46.809  11404948  792.449960\n#> 1702     Zimbabwe    Africa  2002   39.989  11926563  672.038623\n#> 1703     Zimbabwe    Africa  2007   43.487  12311143  469.709298\n#> \n#> [1704 rows x 6 columns]\n```\n:::\n:::\n\n\n- read second sheet\n\n::: {.cell}\n\n```{.python .cell-code}\ncountry_codes = pd.read_excel(\"gapminder.xlsx\", sheet_name = 1)\ncountry_codes\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>                 country iso_alpha  iso_num\n#> 0           Afghanistan       AFG        4\n#> 1               Albania       ALB        8\n#> 2               Algeria       DZA       12\n#> 3                Angola       AGO       24\n#> 4             Argentina       ARG       32\n#> ..                  ...       ...      ...\n#> 182             Vietnam       VNM      704\n#> 183  West Bank and Gaza       PSE      275\n#> 184         Yemen, Rep.       YEM      887\n#> 185              Zambia       ZMB      894\n#> 186            Zimbabwe       ZWE      716\n#> \n#> [187 rows x 3 columns]\n```\n:::\n:::\n\n\n:::{.callout-note}\nIndex in `python` starts with 0.\n:::\n\n:::\n\n\n## parquet\n`Parquet` is an open file format that is great for speed and storage. Some organizeations have changed the way they sharing their data files to `parquet` instead of `csv`.\n\n::: {.panel-tabset}\n### R\nWe use function `read_parquet` from `arrow` package.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder <- read_parquet(\"gapminder.parquet\")\ngapminder\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1,704 × 6\n#>    country     continent  year lifeExp      pop gdpPercap\n#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>\n#>  1 Afghanistan Asia       1952    28.8  8425333      779.\n#>  2 Afghanistan Asia       1957    30.3  9240934      821.\n#>  3 Afghanistan Asia       1962    32.0 10267083      853.\n#>  4 Afghanistan Asia       1967    34.0 11537966      836.\n#>  5 Afghanistan Asia       1972    36.1 13079460      740.\n#>  6 Afghanistan Asia       1977    38.4 14880372      786.\n#>  7 Afghanistan Asia       1982    39.9 12881816      978.\n#>  8 Afghanistan Asia       1987    40.8 13867957      852.\n#>  9 Afghanistan Asia       1992    41.7 16317921      649.\n#> 10 Afghanistan Asia       1997    41.8 22227415      635.\n#> # … with 1,694 more rows\n```\n:::\n:::\n\n\n### python\n`pandas` has a function `read_parquet` to import excel files.\n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder = pd.read_parquet(\"gapminder.parquet\")\ngapminder\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>           country continent  year  lifeExp       pop   gdpPercap\n#> 0     Afghanistan      Asia  1952   28.801   8425333  779.445314\n#> 1     Afghanistan      Asia  1957   30.332   9240934  820.853030\n#> 2     Afghanistan      Asia  1962   31.997  10267083  853.100710\n#> 3     Afghanistan      Asia  1967   34.020  11537966  836.197138\n#> 4     Afghanistan      Asia  1972   36.088  13079460  739.981106\n#> ...           ...       ...   ...      ...       ...         ...\n#> 1699     Zimbabwe    Africa  1987   62.351   9216418  706.157306\n#> 1700     Zimbabwe    Africa  1992   60.377  10704340  693.420786\n#> 1701     Zimbabwe    Africa  1997   46.809  11404948  792.449960\n#> 1702     Zimbabwe    Africa  2002   39.989  11926563  672.038623\n#> 1703     Zimbabwe    Africa  2007   43.487  12311143  469.709298\n#> \n#> [1704 rows x 6 columns]\n```\n:::\n:::\n\n:::\n\n\n# Selecting variables\nIn real data wrangling work, we often get a table that contains too many variables. It is helpful to select only needed variables for further uses. In this tutorial, we select three variables inclduing `country`, `year` and `pop`.\n\n::: {.panel-tabset}\n### R\nWe use `select` from `dplyr` package.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |> select(country, year, pop)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1,704 × 3\n#>    country      year      pop\n#>    <fct>       <int>    <int>\n#>  1 Afghanistan  1952  8425333\n#>  2 Afghanistan  1957  9240934\n#>  3 Afghanistan  1962 10267083\n#>  4 Afghanistan  1967 11537966\n#>  5 Afghanistan  1972 13079460\n#>  6 Afghanistan  1977 14880372\n#>  7 Afghanistan  1982 12881816\n#>  8 Afghanistan  1987 13867957\n#>  9 Afghanistan  1992 16317921\n#> 10 Afghanistan  1997 22227415\n#> # … with 1,694 more rows\n```\n:::\n:::\n\n:::{.callout-note}\nPipe operator `|>` is an operator that take the previous object and apply it to the subsequent function as the first argument (default). We can use `|>` multiple times to the same object. This is called `chaning` This style of coding help coding more human readable as it avoids nested code. This is similar to `method chainging` in `python`.\n\n`|>` was introduced in `R` version 4.0. Previous version used `%>%` from `magrittr`. You will see `%>%` in many tutorials or books.\n:::\n\n### python\nTo subset pandas, we can use `.loc` where the first argument for row, and the second argument is for columns. To select all rows used keyword `:`. To select columns, you can use character vector. \n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder.loc[:, [\"country\", \"year\", \"pop\"]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>           country  year       pop\n#> 0     Afghanistan  1952   8425333\n#> 1     Afghanistan  1957   9240934\n#> 2     Afghanistan  1962  10267083\n#> 3     Afghanistan  1967  11537966\n#> 4     Afghanistan  1972  13079460\n#> ...           ...   ...       ...\n#> 1699     Zimbabwe  1987   9216418\n#> 1700     Zimbabwe  1992  10704340\n#> 1701     Zimbabwe  1997  11404948\n#> 1702     Zimbabwe  2002  11926563\n#> 1703     Zimbabwe  2007  12311143\n#> \n#> [1704 rows x 3 columns]\n```\n:::\n:::\n\n:::\n\n\n# Filtering rows\nWe often interest in a subset of the data. There are many ways to filter data i.e. by index of rows. But one common way is to filter by conditions. In this tutorial, we want a data of Thailand since 1980 from `gapminder`.\n\n::: {.panel-tabset}\n### R\nWe use `filter` from `dplyr` package.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |> filter(country == \"Thailand\" & year > 1980)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 6 × 6\n#>   country  continent  year lifeExp      pop gdpPercap\n#>   <fct>    <fct>     <int>   <dbl>    <int>     <dbl>\n#> 1 Thailand Asia       1982    64.6 48827160     2393.\n#> 2 Thailand Asia       1987    66.1 52910342     2983.\n#> 3 Thailand Asia       1992    67.3 56667095     4617.\n#> 4 Thailand Asia       1997    67.5 60216677     5853.\n#> 5 Thailand Asia       2002    68.6 62806748     5913.\n#> 6 Thailand Asia       2007    70.6 65068149     7458.\n```\n:::\n:::\n\n\n### python\nWe use `query` method from `pandas` package. \n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder.query('country == \"Thailand\" & year > 1980')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        country continent  year  lifeExp       pop    gdpPercap\n#> 1530  Thailand      Asia  1982   64.597  48827160  2393.219781\n#> 1531  Thailand      Asia  1987   66.084  52910342  2982.653773\n#> 1532  Thailand      Asia  1992   67.298  56667095  4616.896545\n#> 1533  Thailand      Asia  1997   67.521  60216677  5852.625497\n#> 1534  Thailand      Asia  2002   68.564  62806748  5913.187529\n#> 1535  Thailand      Asia  2007   70.616  65068149  7458.396327\n```\n:::\n:::\n\n:::{.callout-note}\n`query` method argument is string. If the condition used another string, we need to use `''` and `\"\"` to differentiate between a string used for string comparison and a string used for query arguement as a whole.\n:::\n\n:::\n\n\n# Adding new variables\nWhen we analyze data, we usually have to compute new variable(s) using original variables. In this tutorial, we compute two new vairables\n\n- `pop_m` is population in million.\n- `gdp_m` is total GDP in million USD where gdp is computed from gdpPercap multiply by pop.\n\n::: {.panel-tabset}\n### R\nWe use `mutate` from `dplyr` package. It can use to make multiple variables in single function call.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |> mutate(\n  pop_m = pop / 1e6,\n  gdp_m = gdpPercap*pop/1e6\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1,704 × 8\n#>    country     continent  year lifeExp      pop gdpPercap pop_m  gdp_m\n#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl> <dbl>  <dbl>\n#>  1 Afghanistan Asia       1952    28.8  8425333      779.  8.43  6567.\n#>  2 Afghanistan Asia       1957    30.3  9240934      821.  9.24  7585.\n#>  3 Afghanistan Asia       1962    32.0 10267083      853. 10.3   8759.\n#>  4 Afghanistan Asia       1967    34.0 11537966      836. 11.5   9648.\n#>  5 Afghanistan Asia       1972    36.1 13079460      740. 13.1   9679.\n#>  6 Afghanistan Asia       1977    38.4 14880372      786. 14.9  11698.\n#>  7 Afghanistan Asia       1982    39.9 12881816      978. 12.9  12599.\n#>  8 Afghanistan Asia       1987    40.8 13867957      852. 13.9  11821.\n#>  9 Afghanistan Asia       1992    41.7 16317921      649. 16.3  10596.\n#> 10 Afghanistan Asia       1997    41.8 22227415      635. 22.2  14122.\n#> # … with 1,694 more rows\n```\n:::\n:::\n\n\n### python\nWe use `assign` method from `pandas` package.\n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder.assign(\n  pop_m = lambda df: df['pop']/1e6,\n  gdp_m = lambda df: df['gdpPercap']*df['pop']/1e6\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>           country continent  year  ...   gdpPercap      pop_m        gdp_m\n#> 0     Afghanistan      Asia  1952  ...  779.445314   8.425333  6567.086330\n#> 1     Afghanistan      Asia  1957  ...  820.853030   9.240934  7585.448670\n#> 2     Afghanistan      Asia  1962  ...  853.100710  10.267083  8758.855797\n#> 3     Afghanistan      Asia  1967  ...  836.197138  11.537966  9648.014150\n#> 4     Afghanistan      Asia  1972  ...  739.981106  13.079460  9678.553274\n#> ...           ...       ...   ...  ...         ...        ...          ...\n#> 1699     Zimbabwe    Africa  1987  ...  706.157306   9.216418  6508.240905\n#> 1700     Zimbabwe    Africa  1992  ...  693.420786  10.704340  7422.611852\n#> 1701     Zimbabwe    Africa  1997  ...  792.449960  11.404948  9037.850590\n#> 1702     Zimbabwe    Africa  2002  ...  672.038623  11.926563  8015.110972\n#> 1703     Zimbabwe    Africa  2007  ...  469.709298  12.311143  5782.658337\n#> \n#> [1704 rows x 8 columns]\n```\n:::\n:::\n\n:::\n\n\n# Arranging rows by variables\nOften, we have to sort or rearrange rows by values of particular columns to help us better understanding of data. We can sort from lower to larger (ascending) or the opposite (descending). Also multiple columns can be sorted. In this tutorial, we illustrate two cases\n\n- sort `gapminder` by `continent` and `country` ascending.\n- sort `gapminder` by `year` descending and `continent` ascending.\n\n::: {.panel-tabset}\n### R\nWe use `arrange` from `dplyr` package. Default mode of sorting is ascending, if we want to sort descending, use `desc(variable)` syntax.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |> arrange(continent, country)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1,704 × 6\n#>    country continent  year lifeExp      pop gdpPercap\n#>    <fct>   <fct>     <int>   <dbl>    <int>     <dbl>\n#>  1 Algeria Africa     1952    43.1  9279525     2449.\n#>  2 Algeria Africa     1957    45.7 10270856     3014.\n#>  3 Algeria Africa     1962    48.3 11000948     2551.\n#>  4 Algeria Africa     1967    51.4 12760499     3247.\n#>  5 Algeria Africa     1972    54.5 14760787     4183.\n#>  6 Algeria Africa     1977    58.0 17152804     4910.\n#>  7 Algeria Africa     1982    61.4 20033753     5745.\n#>  8 Algeria Africa     1987    65.8 23254956     5681.\n#>  9 Algeria Africa     1992    67.7 26298373     5023.\n#> 10 Algeria Africa     1997    69.2 29072015     4797.\n#> # … with 1,694 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |> arrange(desc(year), continent)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1,704 × 6\n#>    country                  continent  year lifeExp      pop gdpPercap\n#>    <fct>                    <fct>     <int>   <dbl>    <int>     <dbl>\n#>  1 Algeria                  Africa     2007    72.3 33333216     6223.\n#>  2 Angola                   Africa     2007    42.7 12420476     4797.\n#>  3 Benin                    Africa     2007    56.7  8078314     1441.\n#>  4 Botswana                 Africa     2007    50.7  1639131    12570.\n#>  5 Burkina Faso             Africa     2007    52.3 14326203     1217.\n#>  6 Burundi                  Africa     2007    49.6  8390505      430.\n#>  7 Cameroon                 Africa     2007    50.4 17696293     2042.\n#>  8 Central African Republic Africa     2007    44.7  4369038      706.\n#>  9 Chad                     Africa     2007    50.7 10238807     1704.\n#> 10 Comoros                  Africa     2007    65.2   710960      986.\n#> # … with 1,694 more rows\n```\n:::\n:::\n\n\n### python\nWe use `sort_values` method from `pandas` package. Default mode of sorting is ascending, if we want to sort descending, use ascending arguements.\n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder.sort_values([\"continent\", \"country\"])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>           country continent  year  lifeExp       pop     gdpPercap\n#> 24        Algeria    Africa  1952   43.077   9279525   2449.008185\n#> 25        Algeria    Africa  1957   45.685  10270856   3013.976023\n#> 26        Algeria    Africa  1962   48.303  11000948   2550.816880\n#> 27        Algeria    Africa  1967   51.407  12760499   3246.991771\n#> 28        Algeria    Africa  1972   54.518  14760787   4182.663766\n#> ...           ...       ...   ...      ...       ...           ...\n#> 1099  New Zealand   Oceania  1987   74.320   3317166  19007.191290\n#> 1100  New Zealand   Oceania  1992   76.330   3437674  18363.324940\n#> 1101  New Zealand   Oceania  1997   77.550   3676187  21050.413770\n#> 1102  New Zealand   Oceania  2002   79.110   3908037  23189.801350\n#> 1103  New Zealand   Oceania  2007   80.204   4115771  25185.009110\n#> \n#> [1704 rows x 6 columns]\n```\n:::\n:::\n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder.sort_values([\"year\", \"continent\"], ascending=[True, False])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>           country continent  year  lifeExp       pop     gdpPercap\n#> 60      Australia   Oceania  1952   69.120   8691212  10039.595640\n#> 1092  New Zealand   Oceania  1952   69.390   1994794  10556.575660\n#> 12        Albania    Europe  1952   55.230   1282697   1601.056136\n#> 72        Austria    Europe  1952   66.800   6927772   6137.076492\n#> 108       Belgium    Europe  1952   68.000   8730405   8343.105127\n#> ...           ...       ...   ...      ...       ...           ...\n#> 1547         Togo    Africa  2007   58.420   5701579    882.969944\n#> 1571      Tunisia    Africa  2007   73.923  10276158   7092.923025\n#> 1595       Uganda    Africa  2007   51.542  29170398   1056.380121\n#> 1691       Zambia    Africa  2007   42.384  11746035   1271.211593\n#> 1703     Zimbabwe    Africa  2007   43.487  12311143    469.709298\n#> \n#> [1704 rows x 6 columns]\n```\n:::\n:::\n\n:::\n\n\n# Summarizing and Grouping\nAs data is huge, we need a way or a measure that let us have a better understanding about data. One way is to condense information into some sort of summary statistics i.e. average, min, max, sum, count, etc. These operations are basically reduce the number of rows. In addition, We can summaize data by group (categorial data). In `gapminder`, we will show how to do it without group and with group(s).\n\n## without group\nWe want to find population total and population mean (in millions) of all countries and from 1952 - 2007.\n\n::: {.panel-tabset}\n### R\nWe use `summarize` or `summarise` from `dplyr` package. It can use to make multiple summarized variables in single function call.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |> summarize(\n  pop_total_m = sum(pop)/1e6,\n  pop_mean_m = mean(pop)/1e6\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1 × 2\n#>   pop_total_m pop_mean_m\n#>         <dbl>      <dbl>\n#> 1      50440.       29.6\n```\n:::\n:::\n\n\n### python\nWe use `assign` method from `pandas` package. Alternative approach is to compute each summarization.\n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder[\"pop\"].agg([\"sum\", \"mean\"])/1e6\n\n# alternative\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> sum     50440.465801\n#> mean       29.601212\n#> Name: pop, dtype: float64\n```\n:::\n\n```{.python .cell-code}\ngapminder[\"pop\"].sum()/1e6\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> 50440.465801\n```\n:::\n\n```{.python .cell-code}\ngapminder[\"pop\"].mean()/1e6\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> 29.601212324530515\n```\n:::\n:::\n\n:::\n\n## by groups\nWe want to find population total and population mean (in millions) of all countries and from 1952 - 2007.\n\n::: {.panel-tabset}\n### R\nWe use `group_by` from `dplyr` package before use `summarize` function. The result is grouped dataframe. I normally `ungroup` it to normal dataframe.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |>\n  group_by(continent, year) |>\n  summarize(\n    pop_min_m = min(pop)/1e6,\n    pop_max_m = max(pop)/1e6\n  ) |> ungroup()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 60 × 4\n#>    continent  year pop_min_m pop_max_m\n#>    <fct>     <int>     <dbl>     <dbl>\n#>  1 Africa     1952    0.0600      33.1\n#>  2 Africa     1957    0.0613      37.2\n#>  3 Africa     1962    0.0653      41.9\n#>  4 Africa     1967    0.0708      47.3\n#>  5 Africa     1972    0.0766      53.7\n#>  6 Africa     1977    0.0868      62.2\n#>  7 Africa     1982    0.0986      73.0\n#>  8 Africa     1987    0.111       81.6\n#>  9 Africa     1992    0.126       93.4\n#> 10 Africa     1997    0.146      106. \n#> # … with 50 more rows\n```\n:::\n:::\n\n\n### python\nWe use `groupby` method from `pandas` package by putting it before `agg` method. \n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder.groupby(by=[\"continent\", \"year\"])[\"pop\"].agg([\"min\", \"max\"])/1e6\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>                      min          max\n#> continent year                       \n#> Africa    1952  0.060011    33.119096\n#>           1957  0.061325    37.173340\n#>           1962  0.065345    41.871351\n#>           1967  0.070787    47.287752\n#>           1972  0.076595    53.740085\n#>           1977  0.086796    62.209173\n#>           1982  0.098593    73.039376\n#>           1987  0.110812    81.551520\n#>           1992  0.125911    93.364244\n#>           1997  0.145608   106.207839\n#>           2002  0.170372   119.901274\n#>           2007  0.199579   135.031164\n#> Americas  1952  0.662850   157.553000\n#>           1957  0.764900   171.984000\n#>           1962  0.887498   186.538000\n#>           1967  0.960155   198.712000\n#>           1972  0.975199   209.896000\n#>           1977  1.039009   220.239000\n#>           1982  1.116479   232.187835\n#>           1987  1.191336   242.803533\n#>           1992  1.183669   256.894189\n#>           1997  1.138101   272.911760\n#>           2002  1.101832   287.675526\n#>           2007  1.056608   301.139947\n#> Asia      1952  0.120447   556.263527\n#>           1957  0.138655   637.408000\n#>           1962  0.171863   665.770000\n#>           1967  0.202182   754.550000\n#>           1972  0.230800   862.030000\n#>           1977  0.297410   943.455000\n#>           1982  0.377967  1000.281000\n#>           1987  0.454612  1084.035000\n#>           1992  0.529491  1164.970000\n#>           1997  0.598561  1230.075000\n#>           2002  0.656397  1280.400000\n#>           2007  0.708573  1318.683096\n#> Europe    1952  0.147962    69.145952\n#>           1957  0.165110    71.019069\n#>           1962  0.182053    73.739117\n#>           1967  0.198676    76.368453\n#>           1972  0.209275    78.717088\n#>           1977  0.221823    78.160773\n#>           1982  0.233997    78.335266\n#>           1987  0.244676    77.718298\n#>           1992  0.259012    80.597764\n#>           1997  0.271192    82.011073\n#>           2002  0.288030    82.350671\n#>           2007  0.301931    82.400996\n#> Oceania   1952  1.994794     8.691212\n#>           1957  2.229407     9.712569\n#>           1962  2.488550    10.794968\n#>           1967  2.728150    11.872264\n#>           1972  2.929100    13.177000\n#>           1977  3.164900    14.074100\n#>           1982  3.210650    15.184200\n#>           1987  3.317166    16.257249\n#>           1992  3.437674    17.481977\n#>           1997  3.676187    18.565243\n#>           2002  3.908037    19.546792\n#>           2007  4.115771    20.434176\n```\n:::\n:::\n\n:::\n\n\n# Reshaping table\nReshaping is used we want to change the way data is presenting. There are `wide` format and `long` format.\n\n- `wide` format is a format that have more columns but less rows. Good for making report orpresenting data.\n- `long` format is a format that have less columns but more rows. Good for data management, data warehousing.\n\nWe can convert back and forth as needed. For `excel` user, it is the famous pivot-table function.\n\n## Pivot wider\nConvert from long format to wide format. In this tutorial, we want to make a report of each country of life extectancy by years where we want each year to be a column. We can achieve this by pivot `gapminder` to wide format. \n\n::: {.panel-tabset}\n### R\nWe use `pivot_wider` from `tidyr` package.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |> pivot_wider(\n  id_cols = c(\"continent\", \"country\"), \n  names_from = \"year\",\n  values_from = \"lifeExp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 142 × 14\n#>    continent country     `1952` `1957` `1962` `1967` `1972` `1977` `1982` `1987`\n#>    <fct>     <fct>        <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n#>  1 Asia      Afghanistan   28.8   30.3   32.0   34.0   36.1   38.4   39.9   40.8\n#>  2 Europe    Albania       55.2   59.3   64.8   66.2   67.7   68.9   70.4   72  \n#>  3 Africa    Algeria       43.1   45.7   48.3   51.4   54.5   58.0   61.4   65.8\n#>  4 Africa    Angola        30.0   32.0   34     36.0   37.9   39.5   39.9   39.9\n#>  5 Americas  Argentina     62.5   64.4   65.1   65.6   67.1   68.5   69.9   70.8\n#>  6 Oceania   Australia     69.1   70.3   70.9   71.1   71.9   73.5   74.7   76.3\n#>  7 Europe    Austria       66.8   67.5   69.5   70.1   70.6   72.2   73.2   74.9\n#>  8 Asia      Bahrain       50.9   53.8   56.9   59.9   63.3   65.6   69.1   70.8\n#>  9 Asia      Bangladesh    37.5   39.3   41.2   43.5   45.3   46.9   50.0   52.8\n#> 10 Europe    Belgium       68     69.2   70.2   70.9   71.4   72.8   73.9   75.4\n#> # … with 132 more rows, and 4 more variables: `1992` <dbl>, `1997` <dbl>,\n#> #   `2002` <dbl>, `2007` <dbl>\n```\n:::\n:::\n\n\n### python\nWe use `pivot` method from `pandas` package.\n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder.pivot(\n  index = [\"continent\", \"country\"], \n  columns = \"year\", \n  values = \"lifeExp\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> year                        1952    1957    1962  ...    1997    2002    2007\n#> continent country                                 ...                        \n#> Africa    Algeria         43.077  45.685  48.303  ...  69.152  70.994  72.301\n#>           Angola          30.015  31.999  34.000  ...  40.963  41.003  42.731\n#>           Benin           38.223  40.358  42.618  ...  54.777  54.406  56.728\n#>           Botswana        47.622  49.618  51.520  ...  52.556  46.634  50.728\n#>           Burkina Faso    31.975  34.906  37.814  ...  50.324  50.650  52.295\n#> ...                          ...     ...     ...  ...     ...     ...     ...\n#> Europe    Switzerland     69.620  70.560  71.320  ...  79.370  80.620  81.701\n#>           Turkey          43.585  48.079  52.098  ...  68.835  70.845  71.777\n#>           United Kingdom  69.180  70.420  70.760  ...  77.218  78.471  79.425\n#> Oceania   Australia       69.120  70.330  70.930  ...  78.830  80.370  81.235\n#>           New Zealand     69.390  70.260  71.240  ...  77.550  79.110  80.204\n#> \n#> [142 rows x 12 columns]\n```\n:::\n:::\n\n:::\n\n\n## Pivot longer\nConvert from wide format to long format. In this tutorial, we want to normalize `gapminder` table by moving measurment variables including `lifeExp` `pop` and `gdpPercap` columns into longer format where there is a column to store the variable name and a column store their value. We can achieve this by pivot `gapminder` to long format.\n\n::: {.panel-tabset}\n## R\nWe use `pivot_longer` from `tidyr` package.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |> pivot_longer(\n  cols = c(\"lifeExp\", \"pop\", \"gdpPercap\"), \n  names_to  = \"variable\",\n  values_to = \"value\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 5,112 × 5\n#>    country     continent  year variable       value\n#>    <fct>       <fct>     <int> <chr>          <dbl>\n#>  1 Afghanistan Asia       1952 lifeExp         28.8\n#>  2 Afghanistan Asia       1952 pop        8425333  \n#>  3 Afghanistan Asia       1952 gdpPercap      779. \n#>  4 Afghanistan Asia       1957 lifeExp         30.3\n#>  5 Afghanistan Asia       1957 pop        9240934  \n#>  6 Afghanistan Asia       1957 gdpPercap      821. \n#>  7 Afghanistan Asia       1962 lifeExp         32.0\n#>  8 Afghanistan Asia       1962 pop       10267083  \n#>  9 Afghanistan Asia       1962 gdpPercap      853. \n#> 10 Afghanistan Asia       1967 lifeExp         34.0\n#> # … with 5,102 more rows\n```\n:::\n:::\n\n\n## python\nWe use `melt` method from `pandas` package.\n\n::: {.cell}\n\n```{.python .cell-code}\ngapminder.melt(\n  id_vars = [\"country\", \"continent\", \"year\"],\n  value_vars = [\"lifeExp\", \"pop\", \"gdpPercap\"], \n  var_name = \"variable\", \n  value_name = \"value\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>           country continent  year   variable       value\n#> 0     Afghanistan      Asia  1952    lifeExp   28.801000\n#> 1     Afghanistan      Asia  1957    lifeExp   30.332000\n#> 2     Afghanistan      Asia  1962    lifeExp   31.997000\n#> 3     Afghanistan      Asia  1967    lifeExp   34.020000\n#> 4     Afghanistan      Asia  1972    lifeExp   36.088000\n#> ...           ...       ...   ...        ...         ...\n#> 5107     Zimbabwe    Africa  1987  gdpPercap  706.157306\n#> 5108     Zimbabwe    Africa  1992  gdpPercap  693.420786\n#> 5109     Zimbabwe    Africa  1997  gdpPercap  792.449960\n#> 5110     Zimbabwe    Africa  2002  gdpPercap  672.038623\n#> 5111     Zimbabwe    Africa  2007  gdpPercap  469.709298\n#> \n#> [5112 rows x 5 columns]\n```\n:::\n:::\n\n:::\n\n\n# Join tables\nWe join tables together to enrich data i.e. adding new variables from other table or adding metadata from reference tables. In this tutorial, we add country codes to `gapminder` dataset.\n\nLike SQL-join, there are many types of join. In this tutorial, we illustrate left-join where the left table rows are preserved and add only matched data from right table.\n\n::: {.panel-tabset}\n### R\nWe use `pivot_wider` from `tidyr` package.\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder |> left_join(country_codes, by = c(\"country\" = \"country\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 1,704 × 8\n#>    country     continent  year lifeExp      pop gdpPercap iso_alpha iso_num\n#>    <chr>       <fct>     <int>   <dbl>    <int>     <dbl> <chr>       <dbl>\n#>  1 Afghanistan Asia       1952    28.8  8425333      779. AFG             4\n#>  2 Afghanistan Asia       1957    30.3  9240934      821. AFG             4\n#>  3 Afghanistan Asia       1962    32.0 10267083      853. AFG             4\n#>  4 Afghanistan Asia       1967    34.0 11537966      836. AFG             4\n#>  5 Afghanistan Asia       1972    36.1 13079460      740. AFG             4\n#>  6 Afghanistan Asia       1977    38.4 14880372      786. AFG             4\n#>  7 Afghanistan Asia       1982    39.9 12881816      978. AFG             4\n#>  8 Afghanistan Asia       1987    40.8 13867957      852. AFG             4\n#>  9 Afghanistan Asia       1992    41.7 16317921      649. AFG             4\n#> 10 Afghanistan Asia       1997    41.8 22227415      635. AFG             4\n#> # … with 1,694 more rows\n```\n:::\n:::\n\n\n### python\nWe use `merge` method from `pandas` package.\n\n::: {.cell}\n\n```{.python .cell-code}\n\npd.merge(\n  gapminder, country_codes,\n  how = \"left\",\n  left_on = \"country\",\n  right_on = \"country\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>           country continent  year  ...   gdpPercap  iso_alpha  iso_num\n#> 0     Afghanistan      Asia  1952  ...  779.445314        AFG        4\n#> 1     Afghanistan      Asia  1957  ...  820.853030        AFG        4\n#> 2     Afghanistan      Asia  1962  ...  853.100710        AFG        4\n#> 3     Afghanistan      Asia  1967  ...  836.197138        AFG        4\n#> 4     Afghanistan      Asia  1972  ...  739.981106        AFG        4\n#> ...           ...       ...   ...  ...         ...        ...      ...\n#> 1699     Zimbabwe    Africa  1987  ...  706.157306        ZWE      716\n#> 1700     Zimbabwe    Africa  1992  ...  693.420786        ZWE      716\n#> 1701     Zimbabwe    Africa  1997  ...  792.449960        ZWE      716\n#> 1702     Zimbabwe    Africa  2002  ...  672.038623        ZWE      716\n#> 1703     Zimbabwe    Africa  2007  ...  469.709298        ZWE      716\n#> \n#> [1704 rows x 8 columns]\n```\n:::\n:::\n\n\n- when both tables have the same key column name, can use only argument on\n\n::: {.cell}\n\n```{.python .cell-code}\npd.merge(\n  gapminder, country_codes,\n  how = \"left\",\n  on = \"country\"\n)\n```\n:::\n\n\n:::\n\n\n# Conclusion Remarks\nThere are many topics that do not cover in this tutorial i.e. `date` and `datetime`, `categorial`, `text`, panel data, missing data, advance group statistics, etc. Hope this tutorial help you get start with using programming language like `R` and `python` to do data manipulation task.\n\n## Useful resource:\n\n- https://homepage.divms.uiowa.edu/~luke/classes/STAT4580/dplyr.html#grouped-mutate-and-filter\n- https://dplyr.tidyverse.org\n- https://tidyr.tidyverse.org/\n- https://r4ds.had.co.nz/\n- https://wesmckinney.com/book/\n- https://www.rstudio.com/resources/cheatsheets/\n- https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}